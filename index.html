<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>4X Space Conquest</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/d3-delaunay@6"></script>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>

        <!-- Auth Screen -->
        <div id="authScreen">
            <h1>4X SPACE</h1>
            <div class="subtitle">Conquest</div>

            <div class="auth-container">
                <!-- Login Form -->
                <div id="loginForm" class="auth-form">
                    <h2>Login</h2>
                    <div class="form-group">
                        <input type="email" id="loginEmail" placeholder="Email" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
                    </div>
                    <div id="loginError" class="auth-error"></div>
                    <button id="loginBtn" class="auth-btn">LOGIN</button>
                    <p class="auth-switch">Don't have an account? <a href="#" id="showRegister">Register</a></p>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="auth-form" style="display: none;">
                    <h2>Register</h2>
                    <div class="form-group">
                        <input type="text" id="registerUsername" placeholder="Username" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <input type="email" id="registerEmail" placeholder="Email" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <input type="password" id="registerPassword" placeholder="Password (min 6 characters)" autocomplete="new-password">
                    </div>
                    <div id="registerError" class="auth-error"></div>
                    <button id="registerBtn" class="auth-btn">REGISTER</button>
                    <p class="auth-switch">Already have an account? <a href="#" id="showLogin">Login</a></p>
                </div>

                <div class="auth-divider">
                    <span>or</span>
                </div>

                <button id="guestBtn" class="guest-btn">PLAY AS GUEST</button>
                <p class="guest-note">Guest mode: No saves or leaderboards</p>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" style="display: none;">
            <div class="start-header">
                <h1>4X SPACE</h1>
                <div class="subtitle">Conquest</div>
                <div id="userInfo" class="user-info" style="display: none;">
                    <span>Welcome, <span id="nicknameDisplay"></span>!</span>
                    <button id="editNicknameBtn" class="edit-nickname-btn" title="Edit nickname">‚úèÔ∏è</button>
                    <button id="logoutBtn" class="logout-btn">Logout</button>
                </div>
            </div>

            <div class="start-screen-content">
                <!-- Left Column: New Game Options -->
                <div class="start-column left-column">
                    <div class="menu-section">
                        <h2>Galaxy Size</h2>
                        <div class="option-group">
                            <button class="option-btn selected" data-size="compact">Compact</button>
                            <button class="option-btn" data-size="standard">Standard</button>
                            <button class="option-btn" data-size="vast">Vast</button>
                        </div>
                    </div>

                    <div class="menu-section">
                        <h2>AI Difficulty</h2>
                        <div class="option-group">
                            <button class="option-btn difficulty-easy selected" data-difficulty="easy">Easy</button>
                            <button class="option-btn difficulty-medium" data-difficulty="medium">Medium</button>
                            <button class="option-btn difficulty-hard" data-difficulty="hard">Hard</button>
                        </div>
                    </div>

                    <div class="menu-section">
                        <h2>Your Empire Color</h2>
                        <div class="color-picker" id="playerColorPicker">
                            <div class="color-tile" data-color="blue" style="background: #0096ff;"></div>
                            <div class="color-tile" data-color="red" style="background: #ff3232;"></div>
                            <div class="color-tile" data-color="purple" style="background: #a855f7;"></div>
                            <div class="color-tile" data-color="green" style="background: #00ff88;"></div>
                            <div class="color-tile" data-color="white" style="background: #ffffff;"></div>
                            <div class="color-tile" data-color="orange" style="background: #ff8800;"></div>
                        </div>
                    </div>

                    <div class="menu-section">
                        <h2>AI Empire Color</h2>
                        <div class="color-picker" id="aiColorPicker">
                            <div class="color-tile" data-color="blue" style="background: #0096ff;"></div>
                            <div class="color-tile" data-color="red" style="background: #ff3232;"></div>
                            <div class="color-tile" data-color="purple" style="background: #a855f7;"></div>
                            <div class="color-tile" data-color="green" style="background: #00ff88;"></div>
                            <div class="color-tile" data-color="white" style="background: #ffffff;"></div>
                            <div class="color-tile" data-color="orange" style="background: #ff8800;"></div>
                        </div>
                    </div>

                    <div class="menu-section">
                        <h2>Influence Zone Transparency</h2>
                        <div class="slider-container">
                            <input type="range" id="transparencySlider" min="2" max="25" value="15" step="1">
                            <div class="slider-labels">
                                <span>Subtle</span>
                                <span id="transparencyValue">15%</span>
                                <span>Strong</span>
                            </div>
                        </div>
                    </div>

                    <button id="startBtn">LAUNCH</button>
                </div>

                <!-- Right Column: Saved Games & Leaderboards (only shown when logged in) -->
                <div id="rightColumn" class="start-column right-column" style="display: none;">
                    <!-- Saved Games Section -->
                    <div id="savedGamesSection" class="menu-section saved-games-section">
                        <h2>Saved Games</h2>
                        <div id="savedGamesList" class="saved-games-list">
                            <p class="no-saves">No saved games</p>
                        </div>
                    </div>

                    <!-- Leaderboard Button -->
                    <div id="leaderboardBtnContainer" class="menu-section">
                        <button id="leaderboardBtn" class="leaderboard-btn">VIEW LEADERBOARDS</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Nickname Edit Dialog -->
        <div id="nicknameEditDialog" class="overlay-panel" style="display: none;">
            <div class="panel-content confirm-content">
                <h2>Edit Nickname</h2>
                <div class="form-group">
                    <input type="text" id="nicknameInput" placeholder="Enter nickname" maxlength="20">
                </div>
                <div id="nicknameError" class="auth-error"></div>
                <div class="confirm-buttons">
                    <button id="saveNicknameBtn" class="confirm-btn">SAVE</button>
                    <button id="cancelNicknameBtn" class="confirm-btn">CANCEL</button>
                </div>
            </div>
        </div>

        <!-- Game UI -->
        <div id="ui">
            <div class="resources-row">
                <div class="resource energy">
                    <span class="resource-icon">‚ö°</span>
                    <span id="energyCount">100</span>
                </div>
                <div class="resource minerals">
                    <span class="resource-icon">‚õèÔ∏è</span>
                    <span id="mineralsCount">100</span>
                </div>
                <div class="resource food">
                    <span class="resource-icon">üåø</span>
                    <span id="foodCount">100</span>
                </div>
                <div class="resource score">
                    <span class="resource-icon">‚≠ê</span>
                    <span id="scoreCount">0</span>
                </div>
            </div>
            <div id="turnInfo">
                <button id="settingsBtn" title="Settings (S)">‚öôÔ∏è</button>
                <span>Turn <span id="turnCount">1</span></span>
                <button id="endTurnBtn">END TURN</button>
            </div>
        </div>

        <!-- Settings Overlay -->
        <div id="settingsOverlay">
            <div class="settings-panel">
                <div class="settings-header">
                    <h2>‚öôÔ∏è Settings</h2>
                    <button class="close-btn" onclick="closeSettings()">&times;</button>
                </div>
                <div class="settings-content">
                    <div class="setting-item">
                        <h3>Influence Zones</h3>
                        <div class="toggle-container">
                            <span>OFF</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="influenceZonesToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>ON</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <h3>Influence Zone Transparency</h3>
                        <div class="slider-container">
                            <input type="range" id="gameTransparencySlider" min="2" max="25" value="10" step="1">
                            <div class="slider-labels">
                                <span>Subtle (2%)</span>
                                <span id="gameTransparencyValue">10%</span>
                                <span>Strong (25%)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unified Panel -->
        <div id="unifiedPanel">
            <div class="unified-header">
                <span class="planet-name" id="selectedPlanetName">Planet</span>
                <button class="close-btn" onclick="closePlanetPanel()">&times;</button>
            </div>

            <div id="planetContent"></div>

            <div class="section-divider"></div>

            <div class="fleet-section">
                <h3>Fleet</h3>
                <div class="fleet-tabs">
                    <button class="fleet-tab active" data-tab="stationed" onclick="switchFleetTab('stationed')">Stationed</button>
                    <button class="fleet-tab" data-tab="transit" onclick="switchFleetTab('transit')">In Transit</button>
                </div>
                <div id="fleetContent"></div>
            </div>

            <div class="section-divider"></div>

            <div class="shipyard-section">
                <h3>Shipyard</h3>
                <div id="shipyardContent"></div>
            </div>
        </div>

        <!-- Notifications -->
        <div id="notifications"></div>

        <!-- Destination Hint -->
        <div id="destinationHint">Select destination planet</div>

        <!-- Battle Dialog -->
        <div id="battleDialog">
            <h2>‚öîÔ∏è ENEMY CONTACT</h2>
            <div class="battle-info">
                <p id="battleLocation"></p>
                <p id="battleEnemyForce"></p>
                <p id="battleYourForce"></p>
            </div>
            <div class="battle-buttons">
                <button class="battle-btn fight" onclick="resolveBattle('fight')">‚öîÔ∏è FIGHT</button>
                <button class="battle-btn withdraw" onclick="resolveBattle('withdraw')">üèÉ WITHDRAW</button>
            </div>
        </div>

        <!-- Battle Results Dialog -->
        <div id="battleResultsDialog">
            <!-- Content will be dynamically generated -->
        </div>

        <!-- Zoom Indicator -->
        <div id="zoomIndicator">Zoom: 100%</div>

        <!-- Version Display -->
        <div id="versionDisplay">v2.0.5</div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen">
            <h1 id="gameOverTitle">VICTORY</h1>
            <p id="gameOverMessage">You have conquered the galaxy!</p>
            <div id="gameOverScore" class="game-over-score"></div>
            <div class="game-over-buttons">
                <button id="replaySameMapBtn" class="game-over-btn">REPLAY SAME MAP</button>
                <button id="newGameBtn" class="game-over-btn">NEW GAME</button>
                <button id="gameOverLeaderboardBtn" class="game-over-btn">LEADERBOARDS</button>
                <button id="mainMenuBtn" class="game-over-btn secondary">MAIN MENU</button>
            </div>
        </div>

        <!-- Leaderboard Panel -->
        <div id="leaderboardPanel" class="overlay-panel" style="display: none;">
            <div class="panel-content leaderboard-content">
                <div class="panel-header">
                    <h2>Leaderboards</h2>
                    <button class="close-btn" onclick="closeLeaderboard()">&times;</button>
                </div>
                <div class="leaderboard-tabs">
                    <button class="leaderboard-tab active" data-tab="personal" onclick="switchLeaderboardTab('personal')">Personal Best</button>
                    <button class="leaderboard-tab" data-tab="global" onclick="switchLeaderboardTab('global')">Global Top 10</button>
                </div>
                <div id="leaderboardContent" class="leaderboard-list">
                    <p class="loading">Loading...</p>
                </div>
                <p class="leaderboard-hint">Click on a game to view the final map</p>
            </div>
        </div>

        <!-- Map Viewer Modal -->
        <div id="mapViewerModal" class="overlay-panel" style="display: none;">
            <div class="panel-content map-viewer-content">
                <div class="panel-header">
                    <h2 id="mapViewerTitle">Game Details</h2>
                    <button class="close-btn" onclick="closeMapViewer()">&times;</button>
                </div>
                <div class="map-viewer-info" id="mapViewerInfo"></div>
                <div class="map-viewer-container">
                    <canvas id="mapViewerCanvas"></canvas>
                </div>
                <div class="map-viewer-controls">
                    <button id="replayFromViewerBtn" class="replay-btn">REPLAY THIS MAP</button>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Dialog -->
        <div id="deleteConfirmDialog" class="overlay-panel" style="display: none;">
            <div class="panel-content confirm-content">
                <h2>Delete Saved Game?</h2>
                <p>This action cannot be undone.</p>
                <div class="confirm-buttons">
                    <button id="confirmDeleteBtn" class="confirm-btn danger">DELETE</button>
                    <button id="cancelDeleteBtn" class="confirm-btn">CANCEL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript Modules -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
